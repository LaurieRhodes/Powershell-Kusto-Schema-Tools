# Bicep Tables from JSON

This directory contains Log Analytics custom table Bicep templates generated from JSON schema exports. Each subdirectory represents a single table with deployment-ready Infrastructure as Code.

## Structure

Each table directory contains:

- **`{tablename}-table.bicep`** - Bicep template for table creation
- **`{tablename}-table.parameters.json`** - Parameter file with default values

## Generated Content

### Bicep Templates

- **Resource Type**: `Microsoft.OperationalInsights/workspaces/tables@2025-02-01`
- **Default Plan**: Analytics (configurable to Basic)
- **Default Retention**: 30 days (configurable 4-730 days)
- **Schema Validation**: Column types, data type hints, and descriptions
- **Outputs**: Table name, ID, and provisioning state

### Data Type Hints

Templates may include semantic data type hints:

- **0**: Uri (URLs, links)
- **1**: Guid (TenantId, ObjectId)
- **2**: ArmPath (ResourceId, resource paths) 
- **3**: IP (IP addresses)

### Column Filtering

- **Type column**: Always filtered (reserved by Azure)
- **Underscore columns**: Configurable filtering of system columns (largely reserved by Azure)

## Table Types

### Custom Tables (*_CL)

Purpose-built tables for third-party data ingestion:

- AIShield_CL, Okta_CL, Cloudflare_CL, etc.
- Custom log retention and schema control
- Full column customisation

## Deployment

### Prerequisites

- Log Analytics Workspace
- Contributor permissions on workspace
- Az.Resources PowerShell module

### Parameters

Update `{tablename}-table.parameters.json`:

```json
{
  "workspaceName": { "value": "your-workspace-name" },
  "tablePlan": { "value": "Analytics" },
  "retentionInDays": { "value": "30" },
  "totalRetentionInDays": { "value": "30" }
}
```

### Deployment Command

```powershell
New-AzResourceGroupDeployment `
  -ResourceGroupName "your-rg" `
  -TemplateFile "tablename-table.bicep" `
  -TemplateParameterFile "tablename-table.parameters.json"
```

## Source Generation

Generated by `json-to-bicep-table-export.ps1` from JSON schema exports. Schema validation includes:

- Column name sanitization
- Type conversion (string, int, real, boolean, dateTime, guid, dynamic)
- Reserved column filtering
- Data type hint inference

# 